; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

; ===============================================
; COMMON SETTINGS FOR ALL ENVIRONMENTS
; ===============================================
[env]
framework = arduino
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
monitor_speed = 115200
upload_speed = 921600
upload_protocol = esptool
lib_deps = 
	https://github.com/moononournation/Arduino_GFX.git
platform_packages = platformio/tool-mkspiffs@^2.230.0

; Common build flags / Общие флаги сборки для всех плат
build_flags = 
	-DCORE_DEBUG_LEVEL=3
	-DBOARD_HAS_PSRAM
	-DARDUINO_RUNNING_CORE=1
	-DARDUINO_EVENT_RUNNING_CORE=1
	-DAUDIOTASK_CORE=0
	-DCONFIG_SPIRAM_SUPPORT=1
	-DARDUINO_USB_MODE=1
	-DCONFIG_FREERTOS_USE_TRACE_FACILITY=1
	-DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=1
	-DCONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=1
	-DCONFIG_FREERTOS_USE_STATS_FORMATTING_FUNCTIONS=1
	-I src/src/Perfmon
	; AsyncTCP parameters for custom LwIP libraries compatibility
	; AsyncTCP параметры для работы с кастомными LwIP библиотеками
	-DXQUEUE_SIZE=256
	-DXTASK_MEM_SIZE=32768
	-DMAX_ASYNC_TCP_SLOTS=128

; ===============================================
; BOARD CONFIGURATIONS / Конфигурации плат
; ===============================================

; --- ESP32-S3 N16R8 (16MB Flash + 8MB PSRAM) ---
[env:N16R8_base]
board = esp32s3_n16r8
board_upload.flash_size = 16MB
board_build.arduino.memory_type = qio_opi
board_build.filesystem = spiffs
board_build.partitions = partitions.csv

; --- ESP32-S3 N8R4 (8MB Flash + 4MB PSRAM) - Future boards ---
; Uncomment when adding N8R4 boards / Раскомментировать при добавлении плат N8R4
;[env:N8R4_base]
;board = esp32s3_n4r8
;board_upload.flash_size = 8MB
;board_build.arduino.memory_type = qio_opi
;board_build.filesystem = spiffs
;board_build.partitions = minimal_spiffs.csv

; ===============================================
; DEVICE ENVIRONMENTS / Окружения устройств
; ===============================================

; --- LEGACY ENVIRONMENT (for reference) ---
[env:yoradio-esp32s3]
extends = env:N16R8_base
build_flags = 
	${env.build_flags}
	-DARDUINO_USB_CDC_ON_BOOT=1

; --- JC3248W535C (AXS15231B QSPI, 320x480, 3.5") ---
[env:JC3248W535C]
extends = env:N16R8_base
build_flags =
	${env.build_flags}
	-DARDUINO_USB_CDC_ON_BOOT=1

; --- 4848S040 (ST7701S RGB, 480x480, 4.0") ---
[env:4848S040]
extends = env:N16R8_base
build_flags = 
	${env.build_flags}
	-DARDUINO_USB_CDC_ON_BOOT=0

; --- UEDX48480021 (ST7701S RGB, 480x480, 2.1" round) ---
[env:UEDX48480021]
extends = env:N16R8_base
build_flags = 
	${env.build_flags}
	-DARDUINO_USB_MODE=0
	-DARDUINO_USB_CDC_ON_BOOT=1

; ===============================================
; FUTURE N8R4 BOARDS EXAMPLE / Пример будущих плат N8R4
; ===============================================
; Uncomment and modify when adding new boards with less memory
; Раскомментировать и изменить при добавлении новых плат с меньшей памятью
;
;[env:YourBoard_N8R4]
;extends = env:N8R4_base
;build_flags = 
;	${env.build_flags}
;	-DARDUINO_USB_CDC_ON_BOOT=1
